var ho;!function(e){var a;!function(e){var a;!function(e){function a(e,a){return void 0===a&&(a=window),e.split(".").map(function(e){a=a[e]}),a}e.get=a}(a=e.util||(e.util={}))}(a=e.classloader||(e.classloader={}))}(ho||(ho={}));var ho;!function(e){var a;!function(e){var a;!function(e){function a(e,a){var o=e.split(".");e=o.pop();var r=window;if(o.map(function(e){r[e]=r[e]||{}}),r[e])throw"Global object "+o.join(".")+"."+e+" already exists";r[e]=a}e.expose=a}(a=e.util||(e.util={}))}(a=e.classloader||(e.classloader={}))}(ho||(ho={}));var ho;!function(e){var a;!function(a){var o;!function(a){function o(a){return new e.promise.Promise(function(e,o){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState){var a=r.responseText;200==r.status?e(a):o(a)}},r.open("GET",a),r.send()})}a.get=o}(o=a.xhr||(a.xhr={}))}(a=e.classloader||(e.classloader={}))}(ho||(ho={}));var ho;!function(e){var a;!function(e){var a=function(){function e(e,a){this.name=e.name,this.url=e.url||a(e.name),this.parent=e.parent||!0,this.expose=e.expose||!0,this["super"]=e["super"]}return e}();e.LoadArguments=a}(a=e.classloader||(e.classloader={}))}(ho||(ho={}));var ho;!function(e){var a;!function(e){var a=function(){function a(a){void 0===a&&(a={}),this.loadType=a.loadType||e.LoadType.EVAL,this.urlTemplate=a.urlTemplate||"${name}.js",this.useDir="boolean"==typeof a.useDir?a.useDir:!0,this.useMin="boolean"==typeof a.useMin?a.useMin:!1,this.cache="boolean"==typeof a.cache?a.cache:!0}return a}();e.LoaderConfig=a}(a=e.classloader||(e.classloader={}))}(ho||(ho={}));var ho;!function(e){var a;!function(e){!function(e){e[e.SCRIPT=0]="SCRIPT",e[e.FUNCTION=1]="FUNCTION",e[e.EVAL=2]="EVAL"}(e.LoadType||(e.LoadType={}));e.LoadType}(a=e.classloader||(e.classloader={}))}(ho||(ho={}));var ho;!function(ho){var classloader;!function(classloader){classloader.mapping={};var ClassLoader=function(){function ClassLoader(e){this.conf={},this.cache={},this.conf=new classloader.LoaderConfig(e)}return ClassLoader.prototype.config=function(e){this.conf=new classloader.LoaderConfig(e)},ClassLoader.prototype.load=function(e){switch(e=new classloader.LoadArguments(e,this.resolveUrl.bind(this)),this.conf.loadType){case classloader.LoadType.SCRIPT:return this.load_script(e);case classloader.LoadType.FUNCTION:return this.load_function(e);case classloader.LoadType.EVAL:return this.load_eval(e)}},ClassLoader.prototype.load_script=function(e){function a(){var a=this;return new ho.promise.Promise(function(o,r){var n=e.url,s=document.createElement("script");s.onload=function(){"function"==typeof classloader.util.get(e.name)?o([classloader.util.get(e.name)]):r("Error while loading Class "+e.name)}.bind(a),s.src=n,document.getElementsByTagName("head")[0].appendChild(s)})}var o=this,r=[],n=new ho.promise.Promise;return this.conf.cache&&this.cache[e.name]?ho.promise.Promise.create([this.cache[e.name]]):(e.parent?this.getParentName(e.url).then(function(a){return e["super"]===a?[]:o.load({name:a,parent:!0,expose:e.expose,"super":e["super"]})}).then(function(e){return r=e,a()}).then(function(a){o.conf.cache&&(o.cache[e.name]=a),r=r.concat(a),n.resolve(r)}):a().then(function(e){n.resolve(e)}),n)},ClassLoader.prototype.load_function=function(e){var a,o=this,r=[];return classloader.xhr.get(e.url).then(function(r){if(a=r,e.parent){var n=o.parseParentFromSource(r);return e["super"]===n?[]:o.load({name:n,parent:!0,expose:e.expose,"super":e["super"]})}}).then(function(o){r=o;var n=a+"\nreturn "+e.name+"\n//#sourceURL="+e.url,s=new Function(n)();return e.expose&&classloader.util.expose(e.name,s),s}).then(function(a){return o.conf.cache&&(o.cache[e.name]=a),r.push(a),r})},ClassLoader.prototype.load_eval=function(arg){var self=this,parents=[],source;return classloader.xhr.get(arg.url).then(function(e){if(source=e,arg.parent){var a=self.parseParentFromSource(e);return arg["super"]===a?[]:self.load({name:a,parent:!0,expose:arg.expose,"super":arg["super"]})}}).then(function(p){parents=p;var ret="\n(function(){return "+arg.name+";})();",src=source+ret+"\n//#sourceURL="+arg.url,clazz=eval(src);return arg.expose&&classloader.util.expose(arg.name,clazz),classloader.util.get(arg.name)}).then(function(e){return self.conf.cache&&(self.cache[arg.name]=e),parents.push(e),parents})},ClassLoader.prototype.getParentName=function(e){var a=this;return classloader.xhr.get(e).then(function(e){return a.parseParentFromSource(e)})},ClassLoader.prototype.parseParentFromSource=function(e){var a=/}\)\((.*)\);/,o=e.match(a);return o?o[1]:void 0},ClassLoader.prototype.resolveUrl=function(e){return classloader.mapping[e]?classloader.mapping[e]:(this.conf.useDir&&(e+="."+e.split(".").pop()),e=e.split(".").join("/"),this.conf.useMin&&(e+=".min"),this.conf.urlTemplate.replace("${name}",e))},ClassLoader.prototype.exists=function(e){return!!this.cache[e]},ClassLoader}();classloader.ClassLoader=ClassLoader}(classloader=ho.classloader||(ho.classloader={}))}(ho||(ho={}));var ho;!function(e){var a;!function(e){function a(e){r.config(e)}function o(e){return r.load(e)}var r=new e.ClassLoader;e.config=a,e.load=o}(a=e.classloader||(e.classloader={}))}(ho||(ho={}));